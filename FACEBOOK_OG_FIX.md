# üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã Facebook Open Graph –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## –ü—Ä–æ–±–ª–µ–º–∞ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ
Facebook Debugger –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- ‚úÖ **–ö–æ–¥ –æ—Ç–≤–µ—Ç–∞**: 200 (OK)
- ‚ùå **–û—à–∏–±–∫–∞**: "–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç, –Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–Ω–µ –≤–∞–ª–∏–¥–Ω–æ–µ PNG-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ**.

---

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è Facebook –¥–ª—è og:image

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. **–§–æ—Ä–º–∞—Ç**: JPEG, PNG, GIF, WebP
2. **–†–∞–∑–º–µ—Ä**: –ú–∏–Ω–∏–º—É–º 200√ó200px, **—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 1200√ó630px**
3. **Content-Type**: –î–æ–ª–∂–µ–Ω –±—ã—Ç—å `image/png`, `image/jpeg` –∏ —Ç.–¥.
4. **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞**: –ú–∞–∫—Å–∏–º—É–º 8 –ú–ë
5. **URL**: –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–º (–Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `https://`)
6. **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å**: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω: **1.91:1** (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1200√ó630)
- –§–æ—Ä–º–∞—Ç: **PNG** –∏–ª–∏ **JPEG**
- –ò–∑–±–µ–≥–∞—Ç—å —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ (–±–æ–ª–µ–µ 20% –ø–ª–æ—â–∞–¥–∏)

---

## üêõ –ü—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–∫–∏ "–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞"

### 1. –û—à–∏–±–∫–∞ –≤ –∫–æ–¥–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
–ï—Å–ª–∏ –≤ `og_image_generator.py` –≤–æ–∑–Ω–∏–∫–∞–µ—Ç exception, —Ñ—É–Ω–∫—Ü–∏—è –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å:
- –ü—É—Å—Ç–æ–π –±—É—Ñ–µ—Ä
- HTML-—Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –æ—à–∏–±–∫–æ–π
- –ù–µ–ø–æ–ª–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

### 2. –ü—Ä–æ–±–ª–µ–º–∞ —Å —à—Ä–∏—Ñ—Ç–∞–º–∏
–ù–∞ Railway –Ω–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —à—Ä–∏—Ñ—Ç–æ–≤ ‚Üí Pillow –ø–∞–¥–∞–µ—Ç ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ –≤–º–µ—Å—Ç–æ PNG.

### 3. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Content-Type
–ï—Å–ª–∏ Django view –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `content_type='image/png'` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –∫–æ–¥–µ)

### 1. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
–í `core/views.py` –¥–æ–±–∞–≤–ª–µ–Ω try-except —Å fallback –Ω–∞ –ø—Ä–æ—Å—Ç—É—é –∑–∞–≥–ª—É—à–∫—É:
```python
try:
    image_buffer = generate_task_og_image(task)
    response = HttpResponse(image_buffer.getvalue(), content_type='image/png')
except Exception as e:
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ—Å—Ç—É—é —Å–∏–Ω—é—é –∑–∞–≥–ª—É—à–∫—É
    img = Image.new('RGB', (1200, 630), color='#4F6DF5')
    buffer = BytesIO()
    img.save(buffer, format='PNG')
    response = HttpResponse(buffer.getvalue(), content_type='image/png')
```

### 2. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ fallback –¥–ª—è —à—Ä–∏—Ñ—Ç–æ–≤
–í `core/og_image_generator.py` –ø—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—É—Ç–µ–π:
```python
font_paths = [
    '/usr/share/fonts/truetype/dejavu/DejaVuSans-Bold.ttf',
    '/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf',
    '/System/Library/Fonts/Helvetica.ttc',  # macOS
    'C:\\Windows\\Fonts\\arial.ttf',  # Windows
]
```

### 3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
–í—Å–µ –æ—à–∏–±–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –ª–æ–≥:
```python
logger.error(f"Error generating OG image for task {task_id}: {str(e)}", exc_info=True)
```

---

## üöÄ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é
–û—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `https://hushyor.com/task/5537/og-image.png`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: –î–æ–ª–∂–Ω–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ (—Å–∏–Ω—è—è –∑–∞–≥–ª—É—à–∫–∞ –∏–ª–∏ —Å —Ç–µ–∫—Å—Ç–æ–º).

**–ï—Å–ª–∏ –≤–∏–¥–∏—à—å –æ—à–∏–±–∫—É Django/HTML**: –ó–Ω–∞—á–∏—Ç –∫–æ–¥ –ø–∞–¥–∞–µ—Ç. –°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ Railway.

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Railway
```bash
railway logs --tail 100
```

–ò—â–∏ —Å—Ç—Ä–æ–∫–∏:
- `Error generating OG image for task`
- Traceback —Å –¥–µ—Ç–∞–ª—è–º–∏ –æ—à–∏–±–∫–∏

### –®–∞–≥ 3: –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à Facebook
1. –û—Ç–∫—Ä–æ–π: https://developers.facebook.com/tools/debug/
2. –í—Å—Ç–∞–≤—å: `https://hushyor.com/task/5537/`
3. –ù–∞–∂–º–∏ **"Scrape Again"** 3-5 —Ä–∞–∑
4. –ü—Ä–æ–≤–µ—Ä—å "–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Å—ã–ª–∫–∏"

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞"
**–ü—Ä–∏—á–∏–Ω–∞**: –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ PNG, –∞ HTML/—Ç–µ–∫—Å—Ç/–æ—à–∏–±–∫—É.

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å URL –Ω–∞–ø—Ä—è–º—É—é –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –ï—Å–ª–∏ –≤–∏–¥–∏—à—å –æ—à–∏–±–∫—É Django ‚Üí —Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏
3. –ï—Å–ª–∏ –≤–∏–¥–∏—à—å –ø—É—Å—Ç—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ –≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
**–ü—Ä–∏—á–∏–Ω–∞**: Facebook –∫—ç—à–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ 7 –¥–Ω–µ–π.

**–†–µ—à–µ–Ω–∏–µ**:
- –ò—Å–ø–æ–ª—å–∑—É–π Sharing Debugger ‚Üí "Scrape Again"
- –ò–ª–∏ –∏–∑–º–µ–Ω–∏ URL (–¥–æ–±–∞–≤—å `?v=2` –≤ –∫–æ–Ω—Ü–µ)

### –ü—Ä–æ–±–ª–µ–º–∞: "Could not retrieve data from URL"
**–ü—Ä–∏—á–∏–Ω–∞**: –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404/500.

**–†–µ—à–µ–Ω–∏–µ**:
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Å–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∑–∞–¥–∞—á–∞ —Å —Ç–∞–∫–∏–º ID —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏

---

## üõ†Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 1. –î–æ–±–∞–≤–∏—Ç—å —à—Ä–∏—Ñ—Ç—ã –≤ –ø—Ä–æ–µ–∫—Ç
–ï—Å–ª–∏ –Ω—É–∂–Ω—ã –∫—Ä–∞—Å–∏–≤—ã–µ —à—Ä–∏—Ñ—Ç—ã:

```bash
# –°–∫–∞—á–∞–π —à—Ä–∏—Ñ—Ç
wget https://github.com/dejavu-fonts/dejavu-fonts/releases/download/version_2_37/dejavu-fonts-ttf-2.37.zip
unzip dejavu-fonts-ttf-2.37.zip
mkdir -p static/fonts
cp dejavu-fonts-ttf-2.37/ttf/DejaVuSans.ttf static/fonts/
```

–û–±–Ω–æ–≤–∏ `og_image_generator.py`:
```python
import os
from django.conf import settings

font_paths = [
    os.path.join(settings.BASE_DIR, 'static/fonts/DejaVuSans.ttf'),
    '/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf',
    ...
]
```

### 2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
–î–æ–±–∞–≤—å Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:
```python
from django.core.cache import cache

cache_key = f'og_image_task_{task_id}'
cached_image = cache.get(cache_key)
if cached_image:
    return HttpResponse(cached_image, content_type='image/png')

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏ –∫—ç—à–∏—Ä—É–µ–º
image_buffer = generate_task_og_image(task)
cache.set(cache_key, image_buffer.getvalue(), 86400)  # 24 —á–∞—Å–∞
```

### 3. –°—Ç–∞—Ç–∏—á–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞–∫ fallback
–°–æ–∑–¥–∞–π —Å—Ç–∞—Ç–∏—á–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ `/static/images/og-default.png` –∏ –∏—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ, –µ—Å–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

–í `base.html`:
```html
{% block og_image %}https://hushyor.com/static/images/og-default.png{% endblock %}
```

---

## üìä –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

- [ ] –ó–∞–∫–æ–º–º–∏—á–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `core/og_image_generator.py`
- [ ] –ó–∞–∫–æ–º–º–∏—á–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `core/views.py`
- [ ] `Pillow>=12.0.0` –µ—Å—Ç—å –≤ `requirements.txt`
- [ ] –ó–∞–¥–µ–ø–ª–æ–µ–Ω–æ –Ω–∞ Railway
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é
- [ ] –û—á–∏—â–µ–Ω –∫—ç—à Facebook —á–µ—Ä–µ–∑ Debugger
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –ø—Ä–µ–≤—å—é –≤ Facebook Debugger

---

## üéØ –ò—Ç–æ–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞:

1. **–û—Ç–∫—Ä–æ–π**: `https://hushyor.com/task/5537/og-image.png`
   - –î–æ–ª–∂–Ω–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è —Å–∏–Ω—è—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ (–º–∏–Ω–∏–º—É–º)

2. **–û—á–∏—Å—Ç–∏ –∫—ç—à Facebook**:
   - https://developers.facebook.com/tools/debug/
   - –í—Å—Ç–∞–≤—å URL –∑–∞–¥–∞—á–∏
   - "Scrape Again" –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑

3. **–ü—Ä–æ–≤–µ—Ä—å –ø—Ä–µ–≤—å—é**:
   - –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ –≤ "–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Å—ã–ª–∫–∏"

4. **–ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
   - –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Railway: `railway logs`
   - –ù–∞–π–¥–∏ —Å—Ç—Ä–æ–∫—É —Å –æ—à–∏–±–∫–æ–π
   - –û—Ç–ø—Ä–∞–≤—å –º–Ω–µ —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è:
1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Railway
2. –û—Ç–∫—Ä–æ–π URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ
3. –°–¥–µ–ª–∞–π —Å–∫—Ä–∏–Ω—à–æ—Ç –æ—à–∏–±–∫–∏
4. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ Pillow —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: `pip list | grep Pillow`

**–ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ** ‚Äî –ø—Ä–æ—Å—Ç–æ –∑–∞–¥–µ–ø–ª–æ–π –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –æ—á–∏—Å—Ç–∏ –∫—ç—à Facebook!
